<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ChordPlay — The Interactive Numbered Chord Player</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    text-align: center;
    background: linear-gradient(180deg, #f9f9fc, #f2f5fa);
    color: #333;
    margin: 0;
    padding: 20px;
  }
  h1 {
    font-size: 1.6rem;
    margin-bottom: 8px;
  }
  .controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
  }
  .control-group {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
  }
  button {
    padding: 10px 18px;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    cursor: pointer;
    background: #dfe7f1;
    transition: background 0.2s, transform 0.1s;
  }
  button:hover {
    background: #c9d7e6;
    transform: scale(1.03);
  }
  #chords button {
    width: 70px;
  }
  .active {
    background: #b0c4de;
  }
</style>
</head>
<body>
  <h1>ChordPlay — The Interactive Numbered Chord Player</h1>

  <div class="controls">
    <!-- Metronome Section (moved to top) -->
    <div class="control-group">
      <label>BPM: <input type="number" id="bpm" value="80" min="40" max="240" style="width:60px;"></label>
      <button id="metronome">Start Metronome</button>
    </div>

    <div class="control-group" id="chordType">
      <button data-type="major" class="active">Major</button>
      <button data-type="minor">Minor</button>
      <button data-type="diminished">Dim</button>
      <button data-type="augmented">Aug</button>
    </div>

    <div class="control-group" id="chords">
      <button data-num="1">1</button>
      <button data-num="2">2</button>
      <button data-num="3">3</button>
      <button data-num="4">4</button>
      <button data-num="5">5</button>
      <button data-num="6">6</button>
      <button data-num="7">7</button>
    </div>
  </div>

<script>
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

let currentType = "major";
const baseKey = "C"; 
const baseMidi = 60; // C4 for reference

// Mapping for numbered chords in C major
const chordMap = {
  1: { root: "C", midi: 60 },
  2: { root: "D", midi: 62 },
  3: { root: "E", midi: 64 },
  4: { root: "F", midi: 65 },
  5: { root: "G", midi: 67 },
  6: { root: "A", midi: 69 },
  7: { root: "B", midi: 71 }
};

// Load piano samples (C2–B3)
const pianoSamples = {};
const sampleNotes = [
  "C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2",
  "C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3"
];

async function loadSamples() {
  for (let note of sampleNotes) {
    const response = await fetch(`samples/piano/${note}.wav`);
    const arrayBuffer = await response.arrayBuffer();
    pianoSamples[note] = await audioCtx.decodeAudioData(arrayBuffer);
  }
}
loadSamples();

function noteToMidi(note) {
  const noteNames = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
  const octave = parseInt(note.slice(-1));
  const pitch = note.slice(0, -1);
  return noteNames.indexOf(pitch) + (octave + 1) * 12;
}

function midiToNote(midi) {
  const noteNames = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
  const octave = Math.floor(midi / 12) - 1;
  const note = noteNames[midi % 12];
  return note + octave;
}

function getChordNotes(num, type) {
  const rootMidi = chordMap[num].midi;
  let intervals;
  switch (type) {
    case "minor": intervals = [0, 3, 7]; break;
    case "diminished": intervals = [0, 3, 6]; break;
    case "augmented": intervals = [0, 4, 8]; break;
    default: intervals = [0, 4, 7];
  }

  const chordNotes = intervals.map(i => rootMidi + i);
  const bassNote = rootMidi - 12; // bass 1 octave lower

  // Constrain within range
  const chordLimited = chordNotes.map(n => Math.min(Math.max(n, noteToMidi("C3")), noteToMidi("B3")));
  const bassLimited = Math.min(Math.max(bassNote, noteToMidi("C2")), noteToMidi("B2"));
  return { bass: bassLimited, chord: chordLimited };
}

function playSample(note, volume = 0.9, delay = 0) {
  const buffer = pianoSamples[note];
  if (!buffer) return;

  const source = audioCtx.createBufferSource();
  source.buffer = buffer;

  // add natural decay using gain envelope
  const gainNode = audioCtx.createGain();
  source.connect(gainNode).connect(audioCtx.destination);

  const now = audioCtx.currentTime + delay;
  gainNode.gain.setValueAtTime(volume, now);
  gainNode.gain.exponentialRampToValueAtTime(0.001, now + 1.2); // fade out ~1.2s

  source.start(now);
}

function playChord(num, type) {
  const { bass, chord } = getChordNotes(num, type);
  const allNotes = [bass, ...chord];
  const baseTime = Math.random() * 0.03; // slight random delay for natural feel

  allNotes.forEach((midi, i) => {
    const noteName = midiToNote(midi);
    playSample(noteName, i === 0 ? 1.0 : 0.8, baseTime + i * 0.02);
  });
}

// UI handlers
document.querySelectorAll("#chordType button").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll("#chordType button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    currentType = btn.dataset.type;
  });
});

document.querySelectorAll("#chords button").forEach(btn => {
  btn.addEventListener("click", () => {
    const num = btn.dataset.num;
    playChord(num, currentType);
  });
});

// Metronome
let metronomeRunning = false;
let metronomeInterval;

function playClick(isDownbeat) {
  const osc = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();
  osc.connect(gainNode).connect(audioCtx.destination);
  osc.frequency.value = isDownbeat ? 1000 : 800;
  gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
  osc.start();
  osc.stop(audioCtx.currentTime + 0.1);
}

document.getElementById("metronome").addEventListener("click", () => {
  if (!metronomeRunning) {
    const bpm = parseInt(document.getElementById("bpm").value);
    const interval = (60 / bpm) * 1000;
    let count = 0;
    metronomeInterval = setInterval(() => {
      playClick(count % 4 === 0);
      count++;
    }, interval);
    document.getElementById("metronome").textContent = "Stop Metronome";
    metronomeRunning = true;
  } else {
    clearInterval(metronomeInterval);
    document.getElementById("metronome").textContent = "Start Metronome";
    metronomeRunning = false;
  }
});
</script>
</body>
</html>


<!-- trigger deploy -->


